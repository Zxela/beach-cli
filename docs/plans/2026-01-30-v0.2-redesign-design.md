# Vanbeach v0.2 Redesign

**Date:** 2026-01-30
**Status:** Approved
**Goal:** Improve usefulness, data fidelity, and visual impact

---

## Motivation

The v0.1 CLI works but has gaps:
- Tide data is text-only, hard to visualize patterns
- Recommendations are sometimes wrong (sunset after sunset, swimming in rain)
- Home screen lacks visual density and "wow factor"
- No indication of data freshness or staleness
- Activity scores feel arbitrary without explanation

This redesign addresses all four areas while maintaining the fast, keyboard-driven TUI experience.

---

## 1. Home Screen Redesign

### Smart Header (top section)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VANBEACH                         Thu Jan 30, 14:32  â˜€ 24Â°C    â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚  â˜… Best right now: Kitsilano â€” 24Â°C, calm winds, safe water    â”‚
â”‚    Sunset in 2h 14m â”‚ Next high tide: 16:45 (1.8m)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Elements:**
- Live clock (updates every second)
- Current weather summary for Vancouver
- "Best right now" recommendation with 2-3 key reasons
- Countdown timers for sunset and next major tide event

**"Best Right Now" Logic:**
- Must score â‰¥ 70 for the default/selected activity
- Must pass all weather sanity gates
- Water quality must be known and â‰¤ 48h old
- If nothing qualifies: "No great options right now â€” check back later"

### Enhanced Beach List

```
â”‚ Beach            â”‚ Now  â”‚ Water â”‚ Tide â–â–‚â–„â–ˆâ–†â–ƒâ– â”‚ Best Time   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚â–¶ Kitsilano       â”‚ 24Â°â˜€ â”‚ ğŸŸ¢    â”‚ â–ƒâ–ˆâ–†â–ƒâ–â–‚â–„    â”‚ 15:00 (92)  â”‚
â”‚  English Bay     â”‚ 23Â°â˜€ â”‚ ğŸŸ¡    â”‚ â–ƒâ–ˆâ–†â–ƒâ–â–‚â–„    â”‚ 16:00 (78)  â”‚
â”‚  Jericho         â”‚ 22Â°â›… â”‚ ğŸŸ¢    â”‚ â–ƒâ–ˆâ–†â–ƒâ–â–‚â–„    â”‚ 15:30 (85)  â”‚
```

**New columns:**
- **Tide sparkline:** 12-char visual showing today's tide curve (6am-9pm), with vertical bar at current hour
- **Best Time:** Optimal hour and score for selected activity

**Weather enhancements:**
- Show "feels like" temperature when significantly different
- Precipitation probability on hover/detail
- Trend indicator: â†‘ rising, â†“ falling, â†’ stable

### Bottom Status Bar

```
â”‚ [j/k] Navigate  [Enter] Details  [p] Plan Trip  [r] Refresh  â”‚
â”‚ Data: Weather 2m ago â”‚ Tides live â”‚ Water quality 3h ago      â”‚
```

- Keybinding hints
- Data freshness indicators for each source
- Staleness warnings (âš ) when data is old

---

## 2. Tide Visualization System

### Inline Sparklines (home screen)

```
â–â–‚â–„â–ˆâ–†â–ƒâ–â–‚â–„â–ˆâ–†â–ƒ
      â”ƒ
```

- 12 characters wide, covers 6am-9pm (~75 min per character)
- Vertical bar indicates current time position
- Unicode block characters: `â–â–‚â–ƒâ–„â–…â–†â–‡â–ˆ` mapped to tide height (0-max)

### Beach Detail - Dedicated Tide Panel

```
â”Œâ”€ Today's Tides â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                              â”‚
â”‚  2.0m â”¤          â–ˆâ–ˆâ–ˆâ–ˆ                          â–ˆâ–ˆâ–ˆ           â”‚
â”‚  1.5m â”¤       â–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆ                    â–ˆâ–ˆâ–ˆ   â–ˆâ–ˆ         â”‚
â”‚  1.0m â”¤    â–ˆâ–ˆâ–ˆ          â–ˆâ–ˆâ–ˆ              â–ˆâ–ˆâ–ˆ        â–ˆâ–ˆ       â”‚
â”‚  0.5m â”¤ â–ˆâ–ˆâ–ˆ                â–ˆâ–ˆâ–ˆ        â–ˆâ–ˆâ–ˆ            â–ˆâ–ˆ      â”‚
â”‚  0.0m â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€   â”‚
â”‚       6   8   10  12  14  16  18  20  22  0   2   4   6      â”‚
â”‚                       â–²                                       â”‚
â”‚                      NOW                                      â”‚
â”‚                                                              â”‚
â”‚  Current: 1.2m (rising) â”‚ High: 16:45 (2.1m) â”‚ Low: 23:12    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- Full 24-hour view with labeled axes
- "NOW" marker showing current position
- Current height, direction (rising/falling), and next high/low times

### Plan Trip - Tide Overlay

```
â”‚ Beach          â”‚ 06 â”‚ 08 â”‚ 10 â”‚ 12 â”‚ 14 â”‚ 16 â”‚ 18 â”‚ 20 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
â”‚ Kitsilano      â”‚â–ƒ 72â”‚â–… 85â”‚â–ˆ 91â”‚â–† 88â”‚â–„ 75â”‚â–‚ 60â”‚â–… 82â”‚â–ƒ 45â”‚
â”‚ English Bay    â”‚â–ƒ 65â”‚â–… 78â”‚â–ˆ 84â”‚â–† 80â”‚â–„ 68â”‚â–‚ 52â”‚â–… 76â”‚â–ƒ 38â”‚
```

- Small tide indicator (â–-â–ˆ) in each cell alongside activity score
- Visual correlation: high tide + good score = optimal

### Tide-Activity Integration

- **Sailing:** Score boost during high tide (more water, better sailing)
- **Swimming:** Slight penalty at extreme low tide (exposed rocks, shallow)
- **Sunset:** Unaffected by tide
- **Sunbathing:** Unaffected by tide
- **Peace & Quiet:** Unaffected by tide

---

## 3. Recommendation Engine Fixes

### Bug Fixes

#### 3.1 Sunset Time Filtering
**Problem:** Recommends sunset viewing after sunset has passed.

**Fix:** In `compute_best_windows()` for Sunset activity:
- Get actual sunset time for the day
- Filter out hours *after* sunset, not just past hours
- If sunset is 17:30, hours 18:00+ should be excluded

#### 3.2 Weather Sanity Gates
**Problem:** Recommends swimming when raining or freezing.

**Fix:** Add hard blockers that zero out scores:

| Activity | Block Conditions |
|----------|------------------|
| Swimming | temp < 15Â°C, rain, thunderstorm |
| Sunbathing | rain, overcast, temp < 18Â°C |
| Sailing | wind > 40 km/h, thunderstorm |
| All | severe weather codes (storm, heavy rain, snow) |

Implementation: Check gates *before* scoring. If blocked, score = 0 and mark as "blocked" in UI.

#### 3.3 Water Quality Staleness
**Problem:** Shows "safe" when data is days old.

**Fix:**
- If sample date > 48 hours old: downgrade ğŸŸ¢ to âšª "Unknown"
- Apply score penalty (0.5 multiplier) for unknown status
- Show "Last tested: X days ago" in UI
- If sample date > 7 days: show âš  warning

### Score Transparency

Replace opaque "Score: 85" with visible breakdown:

```
â”Œâ”€ Why 15:00 scores 85 for Swimming â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                              â”‚
â”‚  Temperature   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘  24Â°C (ideal: 22-28Â°C)       +35   â”‚
â”‚  Water Quality â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  Safe, tested today          +25   â”‚
â”‚  Wind          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘  12 km/h (calm)              +15   â”‚
â”‚  UV Index      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘  6 (moderate)                +10   â”‚
â”‚  Crowd Level   â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘  Moderate                     +0   â”‚
â”‚                                           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                           Total:        85   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Display context:**
- Show in Beach Detail view when a time window is selected
- Visual bars (filled/empty) show contribution
- Actual values alongside ideal ranges
- Helps users understand and trust recommendations

---

## 4. Live Updating & Refresh

### Real-time Elements (update every second)

- Clock in header: `14:32:45`
- Sunset countdown: `Sunset in 2h 14m 23s`
- Tide countdown: `High tide in 1h 52m`
- "NOW" marker position on tide charts

### Background Data Refresh

| Data Source | Refresh Interval | Rationale |
|-------------|------------------|-----------|
| Weather | 5 minutes | API is free, conditions change |
| Tides | Once at startup | Predictable, static predictions |
| Water Quality | 30 minutes | City updates ~daily |

**Visual feedback:**
- Subtle spinner in status bar during fetch
- Stale warning if refresh fails: `âš  Weather: 12m ago`

### Manual Refresh

- `r` key triggers immediate refresh of all data
- Status bar shows "Refreshing..." with per-source progress
- Toast-style confirmation: "âœ“ Data updated" (fades after 2s)

### Async Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Main Thread                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  Input  â”‚â”€â”€â”€â–¶â”‚   App   â”‚â”€â”€â”€â–¶â”‚   UI    â”‚                 â”‚
â”‚  â”‚ Handler â”‚    â”‚  State  â”‚    â”‚ Render  â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â–²â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                      â”‚                                      â”‚
â”‚                      â”‚ channel                              â”‚
â”‚                      â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Background Refresh Task                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚  â”‚
â”‚  â”‚  â”‚ Weather â”‚  â”‚  Tides  â”‚  â”‚  Water  â”‚              â”‚  â”‚
â”‚  â”‚  â”‚  Fetch  â”‚  â”‚  Fetch  â”‚  â”‚ Quality â”‚              â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- Background tokio task handles refresh loop
- UI thread never blocks on network
- Channel-based updates push new data to app state
- Graceful degradation: if refresh fails, show last good data with staleness warning

---

## 5. Visual Polish

### Color Palette

| Element | Color | Usage |
|---------|-------|-------|
| Score 90+ | Bright green (#00ff00) | Excellent conditions |
| Score 70-89 | Green (#00cc00) | Good conditions |
| Score 50-69 | Yellow (#ffcc00) | Fair conditions |
| Score 30-49 | Orange (#ff8800) | Poor conditions |
| Score <30 | Red (#ff0000) | Bad conditions |
| Blocked | Dim gray + strikethrough | Sanity gate failed |
| Tide charts | Water blue (#5599ff) | All tide visualizations |
| Sunset countdown | Orangeâ†’pink gradient | As time approaches |
| Stale data | Dim gray | Data freshness warnings |
| Fresh data | Bright white | Recently updated |

### New Keyboard Shortcuts

| Key | Action |
|-----|--------|
| `r` | Refresh all data |
| `?` | Help overlay showing all keybindings |
| `s` | Jump to sunset activity filter |
| `1-5` | Activity selection (works from home screen too) |

### Startup Experience

```
$ vanbeach

  Loading Vancouver beaches...
  â”œâ”€ Weather       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 12/12 beaches
  â”œâ”€ Water quality â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 8/12 stations
  â””â”€ Tides         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ Ready

  Press any key to continue or wait 2s...
```

- Shows loading progress with parallel fetch visualization
- Auto-proceeds after brief delay
- Gives confidence that data is fresh on launch

---

## Implementation Priority

### Phase 1: Bug Fixes (High Impact, Lower Effort)
1. Sunset time filtering fix
2. Weather sanity gates
3. Water quality staleness handling

### Phase 2: Home Screen Redesign (High Impact, Medium Effort)
4. Smart header with live clock and countdowns
5. Inline tide sparklines
6. "Best Time" column
7. Data freshness status bar

### Phase 3: Tide Visualization (Medium Impact, Medium Effort)
8. Beach detail tide chart
9. Plan Trip tide overlay
10. Tide-activity integration in scoring

### Phase 4: Live Updates (Medium Impact, Higher Effort)
11. Background refresh architecture
12. Real-time countdown updates
13. Manual refresh with feedback

### Phase 5: Polish (Lower Impact, Lower Effort)
14. Score transparency breakdown
15. Enhanced color palette
16. Startup loading screen
17. Help overlay

---

## Success Criteria

- [ ] Sunset recommendations never suggest times after sunset
- [ ] Swimming never recommended when raining or below 15Â°C
- [ ] Water quality shows staleness when sample > 48h old
- [ ] Home screen shows tide sparklines for all beaches
- [ ] Clock and countdowns update in real-time
- [ ] Users can see *why* a time scored what it did
- [ ] Data freshness visible at a glance
- [ ] First-time users say "wow" when opening the app
